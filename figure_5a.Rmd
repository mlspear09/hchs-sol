---
title: "Figure 5A"
author: "Melissa Spear"
date: "21/07/2020"
output: html_document
---

```{r}
###Plotting PRS based on 1 Mb distance SNPs, stratifed by ancestry 
pheno_file<-read.table("/Users/melissaspear/Dropbox/HCHS_SOL/HCHS_SOL_Mexicans_admixed_95_full_pheno_010919.txt",header=T, sep='\t')

PRS_phys<-read.table("HCHS_SOL_Mexicans_040219_UKBB_snps_individual_polygenic_height_scores_phys_distance_1Mb_filter.txt")
names(PRS_phys)<-c("FID","IID","risk_score")
merged_data_phys<-merge(PRS_phys,pheno_file,by.x=("FID"),by.y=c("V1"))


#setting "Center" variable as numeric so R knows how to use it in model 
merged_data_phys$CENTER2<-as.numeric(merged_data_phys$CENTER)

#Dividing dataset 
Lowest_NAM <- merged_data_phys[which(merged_data_phys$NAM>=0.01 & merged_data_phys$NAM<0.37),]
Lower_NAM <- merged_data_phys[which(merged_data_phys$NAM>=0.37 & merged_data_phys$NAM<0.46),]
Moderate_NAM <- merged_data_phys[which(merged_data_phys$NAM>=0.46 & merged_data_phys$NAM<=0.58),]
High_NAM <- merged_data_phys[which(merged_data_phys$NAM>0.58),]

highest_NAM_half<-merged_data_phys[which(merged_data_phys$NAM>0.46),]

Lowest_NAM$native_level="4"
Lower_NAM$native_level="3"
Moderate_NAM$native_level="2"
High_NAM$native_level="1"

all_levels<-rbind(Lowest_NAM,Lower_NAM,Moderate_NAM,High_NAM)

```



```{r}
################################################################################

##### PRS as a function of birthyear 

# Setting model for each stratified dataset - No effect of birth year/age on PRS. 

Lowest_model_center <- lm(risk_score~estimated_birth_year+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lowest_NAM)
Lower_model_center <- lm(risk_score~estimated_birth_year+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lower_NAM)
Moderate_model_center <- lm(risk_score~estimated_birth_year+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Moderate_NAM)
High_model_center <- lm(risk_score~estimated_birth_year+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=High_NAM)
all_groups_center <- lm(risk_score~estimated_birth_year+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=all_levels)

# Plot 
mypalette<-brewer.pal(5,"Set1")


#Paper plot - Birth year (X) and polygenic risk score (Y)
#adjusting by center
par(mfrow=c(1,1))
#pdf("/Users/melissaspear/Dropbox/HCHS_SOL/PRS/phys_distance_1Mb/plots/HCHS_SOL_Mexican_PRS_estimated_birth_year_NAM_ancestry_stratified_041219.pdf",height=5.00,width=6,pointsize=9)
#pdf("/Users/melissaspear/Dropbox/HCHS_SOL/paper/figures/HCHS_SOL_Mexican_Height_PRS_estimated_birth_year_NAM_ancestry_stratified_073119_diffcolors.pdf",height=2.25,width=2.375,pointsize=10)
par(mar=c(2.1,2.1,0.1,0.1))
plot(1,1,type='n',xlim=range(merged_data_phys$estimated_birth_year),ylim=c(-1,1),xlab="",ylab="",xaxt='n',yaxt='n')
abline(h=seq(-1,1,by=0.5),col=rgb(0,0,0,0.1))
abline(v=seq(1930,2000,by=5),col=rgb(0,0,0,0.1))
axis(side=1,padj=-2,cex.axis=0.7)
axis(side=2,padj=1.5,cex.axis=0.7)
mtext(side=1,"Birth year",line=1.1)
mtext(side=2,"Polygenic height score (cm)",line=1.1)
#grid(nx = NULL, ny = NULL, col = "lightgray", lty = "dotted")
points(merged_data_phys$estimated_birth_year,merged_data_phys$risk_score,pch=20,cex=0.8)
points(Lowest_NAM$estimated_birth_year,Lowest_NAM$risk_score,col=mypalette2[3],pch=20,cex=0.8)
points(Lower_NAM$estimated_birth_year,Lower_NAM$risk_score,col=mypalette2[5],pch=20,cex=0.8)
points(Moderate_NAM$estimated_birth_year,Moderate_NAM$risk_score,col=mypalette2[6],pch=20,cex=0.8)
points(High_NAM$estimated_birth_year,High_NAM$risk_score,col=mypalette2[8],pch=20,cex=0.8)
lines(x = 1932:1993, y = coefficients(Lowest_model_center)[1] + coefficients(Lowest_model_center)[2]* (1932:1993), col =mypalette2[3],lwd = 3)
lines(x = 1932:1993, y = coefficients(Lower_model_center)[1] + coefficients(Lower_model_center)[2]* (1932:1993), col =mypalette2[5],lwd = 3)
lines(x = 1932:1993, y = coefficients(Moderate_model_center)[1] + coefficients(Moderate_model_center)[2]* (1932:1993), col =mypalette2[6],lwd = 3)
lines(x = 1932:1993, y = coefficients(High_model_center)[1] + coefficients(High_model_center)[2]* (1932:1993), col =mypalette2[8],lwd = 3)
lines(x = 1932:1993, y = coefficients(all_groups_center)[1] + coefficients(all_groups_center)[2]* (1932:1993), col = 'black',lwd = 3)
legend("topright", legend=c("0.01<NAM<0.37","0.37<NAM<0.46","0.46<NAM<0.58","0.58<NAM","All"),
       col=c(mypalette2[3],mypalette2[5],mypalette2[6],mypalette2[8],"black"), bg="white",lty=1, lwd=2,cex=0.4)
#dev.off()


```
################################################################################
###PRS as a function of height 

Lowest_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lowest_NAM)
Lower_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lower_NAM)
Moderate_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Moderate_NAM)
High_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=High_NAM)
all_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=all_levels)

highest_NAM_half_model_center_height <- lm(risk_score~HEIGHT+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=highest_NAM_half)


Lowest_model_center_height2 <- lm(HEIGHT~risk_score+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lowest_NAM)
Lower_model_center_height2 <- lm(HEIGHT~risk_score+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Lower_NAM)
Moderate_model_center_height2 <- lm(HEIGHT~risk_score+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=Moderate_NAM)
High_model_center_height2 <- lm(HEIGHT~risk_score+GENDERNUM+log(WEIGHT_FINAL_NORM_OVERALL)+CENTER2,data=High_NAM)

# Plot 
mypalette<-brewer.pal(5,"Set1")


par(mfrow=c(1,1))
#pdf("/Users/melissaspear/Dropbox/HCHS_SOL/PRS/phys_distance_1Mb/plots/HCHS_SOL_Mexican_PRS_Height_NAM_ancestry_stratified_041219.pdf",height=5.00,width=6,pointsize=9)
pdf("/Users/melissaspear/Dropbox/HCHS_SOL/paper/figures/HCHS_SOL_Mexican_PRS_Height_NAM_ancestry_stratified_041219.pdf",height=2.25,width=2.375,pointsize=10)
plot(merged_data_phys$HEIGHT,merged_data_phys$risk_score,xlab="Height (cm)", ylab="PRS (cm)")
points(Lowest_NAM$HEIGHT,Lowest_NAM$risk_score,col="#E41A1C",pch=20)
points(Lower_NAM$HEIGHT,Lower_NAM$risk_score,col="#FF7F00",pch=20)
points(Moderate_NAM$HEIGHT,Moderate_NAM$risk_score,col="#4DAF4A",pch=20)
points(High_NAM$HEIGHT,High_NAM$risk_score,col="#377EB8",pch=20)
lines(x = 122:195, y = coefficients(Lowest_model_center_height)[1] + coefficients(Lowest_model_center_height)[2]* (122:195), col = '#E41A1C',lwd = 3)
lines(x = 122:195, y = coefficients(Lower_model_center_height)[1] + coefficients(Lower_model_center_height)[2]* (122:195), col = '#FF7F00',lwd = 3)
lines(x = 122:195, y = coefficients(Moderate_model_center_height)[1] + coefficients(Moderate_model_center_height)[2]* (122:195), col = '#4DAF4A',lwd = 3)
lines(x = 122:195, y = coefficients(High_model_center_height)[1] + coefficients(High_model_center_height)[2]* (122:195), col = '#377EB8',lwd = 3)
lines(x = 122:195, y = coefficients(all_model_center_height)[1] + coefficients(all_model_center_height)[2]* (122:195), col = 'black',lwd = 3)
legend("bottomleft", legend=c("0.01<NAM<0.37","0.37<NAM<0.46","0.46<NAM<0.58","0.58<NAM","All"),
       col=c("#E41A1C", "#FF7F00","#4DAF4A","#377EB8","black"), lty=1, lwd=2,cex=0.8)
# dev.off()

summary(merged_data_phys$risk_score)

which(colnames(merged_data_phys)=="HEIGHT")
> which(colnames(merged_data_phys)=="HEIGHT")
[1] 51

merged_data_phys_noNAs = merged_data_phys[complete.cases(merged_data_phys$NAM, merged_data_phys$risk_score, merged_data_phys$GENDERNUM, merged_data_phys$WEIGHT_FINAL_NORM_OVERALL, merged_data_phys$CENTER2, merged_data_phys$HEIGHT),]

########PAPER plot with base R graphics 
```{r}
library("ggplot2")
library("gridExtra")
require(RColorBrewer)

###plotting the PRS by birthyear 
mypalette2<-brewer.pal(9,"BuPu")


#pdf("/Users/melissaspear/Dropbox/HCHS_SOL/paper/figures/HCHS_SOL_Mexican_PRS_Height_NAM_ancestry_stratified_102119_diffcolors_figure_4b.pdf",height=2.25,width=2.375,pointsize=10)
par(mar=c(2.1,2.1,0.1,0.1))

plot(1,1,type='n',xlim=range(merged_data_phys_noNAs$HEIGHT),ylim=c(-1,1),xlab="",ylab="",xaxt='n',yaxt='n')
abline(h=seq(-1,1,by=0.5),col=rgb(0,0,0,0.1))
abline(v=seq(120,200,by=10),col=rgb(0,0,0,0.1))
points(merged_data_phys$HEIGHT,merged_data_phys$risk_score,pch=20,cex=0.8)
#plot(merged_data_phys$HEIGHT,merged_data_phys$risk_score,xlab="Height (cm)", ylab="PRS (cm)")
points(Lowest_NAM$HEIGHT,Lowest_NAM$risk_score,col=mypalette2[3],pch=20,cex=0.8)
points(Lower_NAM$HEIGHT,Lower_NAM$risk_score,col=mypalette2[5],pch=20,cex=0.8)
points(Moderate_NAM$HEIGHT,Moderate_NAM$risk_score,col=mypalette2[6],pch=20,cex=0.8)
points(High_NAM$HEIGHT,High_NAM$risk_score,col=mypalette2[8],pch=20,cex=0.8)
axis(side=1,padj=-2,cex.axis=0.7)
axis(side=2,padj=1.5,cex.axis=0.7)
mtext(side=1,"Height (cm)",line=1.1)
mtext(side=2,"Polygenic height score (cm)",line=1.1)
lines(x = 122:195, y = coefficients(Lowest_model_center_height)[1] + coefficients(Lowest_model_center_height)[2]* (122:195), col ="white",lwd = 4)
lines(x = 122:195, y = coefficients(Lowest_model_center_height)[1] + coefficients(Lowest_model_center_height)[2]* (122:195), col =mypalette2[3],lwd = 3)

lines(x = 122:195, y = coefficients(Lower_model_center_height)[1] + coefficients(Lower_model_center_height)[2]* (122:195), col ="white",lwd = 4)
lines(x = 122:195, y = coefficients(Lower_model_center_height)[1] + coefficients(Lower_model_center_height)[2]* (122:195), col =mypalette2[5],lwd = 3)

lines(x = 122:195, y = coefficients(Moderate_model_center_height)[1] + coefficients(Moderate_model_center_height)[2]* (122:195), col ="white",lwd = 4)
lines(x = 122:195, y = coefficients(Moderate_model_center_height)[1] + coefficients(Moderate_model_center_height)[2]* (122:195), col =mypalette2[6],lwd = 3)

lines(x = 122:195, y = coefficients(High_model_center_height)[1] + coefficients(High_model_center_height)[2]* (122:195), col ="white",lwd = 4)
lines(x = 122:195, y = coefficients(High_model_center_height)[1] + coefficients(High_model_center_height)[2]* (122:195), col =mypalette2[8],lwd = 3)

lines(x = 122:195, y = coefficients(all_model_center_height)[1] + coefficients(all_model_center_height)[2]* (122:195), col = 'white',lwd = 4)
lines(x = 122:195, y = coefficients(all_model_center_height)[1] + coefficients(all_model_center_height)[2]* (122:195), col = 'black',lwd = 3)

legend("topleft", legend=c("0.01<AI<0.37","0.37<AI<0.46","0.46<AI<0.58","0.58<AI","All"),
       col=c(mypalette2[3],mypalette2[5],mypalette2[6],mypalette2[8],"black"),bg="white", lty=1, lwd=2,cex=0.4)
#dev.off()

```